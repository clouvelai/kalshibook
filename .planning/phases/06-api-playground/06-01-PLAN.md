---
phase: 06-api-playground
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - dashboard/package.json
  - dashboard/package-lock.json
  - dashboard/src/components/ui/tabs.tsx
  - dashboard/src/components/sidebar/app-sidebar.tsx
  - dashboard/src/app/(dashboard)/playground/page.tsx
  - dashboard/src/components/playground/use-playground.ts
  - dashboard/src/lib/playground.ts
  - dashboard/src/types/api.ts
autonomous: true

must_haves:
  truths:
    - "Playground link appears in sidebar after Overview and before API Keys"
    - "Navigating to /playground renders a page with split-panel layout"
    - "usePlayground hook manages form state, curl generation, and request lifecycle"
  artifacts:
    - path: "dashboard/src/app/(dashboard)/playground/page.tsx"
      provides: "Playground page shell with split-panel layout"
      min_lines: 20
    - path: "dashboard/src/components/playground/use-playground.ts"
      provides: "Custom hook for all playground state and actions"
      exports: ["usePlayground"]
    - path: "dashboard/src/lib/playground.ts"
      provides: "API key auth fetch utility for playground requests"
      exports: ["executePlaygroundRequest"]
    - path: "dashboard/src/components/ui/tabs.tsx"
      provides: "shadcn/ui Tabs component"
  key_links:
    - from: "dashboard/src/components/sidebar/app-sidebar.tsx"
      to: "/playground"
      via: "navItems array entry with Terminal icon"
      pattern: "Terminal.*playground"
    - from: "dashboard/src/components/playground/use-playground.ts"
      to: "dashboard/src/lib/playground.ts"
      via: "executePlaygroundRequest import"
      pattern: "import.*executePlaygroundRequest.*playground"
---

<objective>
Install dependencies, scaffold the playground page with split-panel layout, build the usePlayground state hook, and add sidebar navigation.

Purpose: Establishes the foundation -- page routing, state management, fetch utility, and nav -- that Plan 02 and 03 build UI components on top of.
Output: Working /playground route with empty panels, complete state hook, API key auth fetch utility, and sidebar entry.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-api-playground/06-RESEARCH.md
@dashboard/src/components/sidebar/app-sidebar.tsx
@dashboard/src/lib/api.ts
@dashboard/src/types/api.ts
@dashboard/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and add sidebar navigation</name>
  <files>
    dashboard/package.json
    dashboard/package-lock.json
    dashboard/src/components/ui/tabs.tsx
    dashboard/src/components/sidebar/app-sidebar.tsx
  </files>
  <action>
    1. Install prism-react-renderer:
       ```
       cd dashboard && npm install prism-react-renderer
       ```

    2. Add shadcn/ui Tabs component:
       ```
       cd dashboard && npx shadcn@latest add tabs --yes
       ```

    3. Update sidebar nav in `app-sidebar.tsx`:
       - Add `Terminal` to the lucide-react import
       - Insert a Playground nav item after Overview (index 1) in the navItems array:
         ```ts
         {
           title: "Playground",
           href: "/playground",
           icon: Terminal,
           external: false,
         },
         ```
       - Final order: Overview, Playground, API Keys, Billing, Documentation
  </action>
  <verify>
    - `cd dashboard && npm ls prism-react-renderer` shows installed version
    - `dashboard/src/components/ui/tabs.tsx` exists
    - Grep app-sidebar.tsx for "Playground" and "Terminal" confirms nav item added
    - `cd dashboard && npx next build 2>&1 | tail -5` compiles without errors (or use `npx tsc --noEmit`)
  </verify>
  <done>prism-react-renderer installed, shadcn Tabs component added, sidebar shows Playground after Overview and before API Keys</done>
</task>

<task type="auto">
  <name>Task 2: Create playground page shell, state hook, and fetch utility</name>
  <files>
    dashboard/src/app/(dashboard)/playground/page.tsx
    dashboard/src/components/playground/use-playground.ts
    dashboard/src/lib/playground.ts
    dashboard/src/types/api.ts
  </files>
  <action>
    1. Create `dashboard/src/lib/playground.ts` -- playground-specific fetch using API key auth (NOT Supabase JWT):
       - Export `PlaygroundResult` interface: `{ data: unknown; status: number; responseTime: number; creditsDeducted: number | null; creditsRemaining: number | null }`
       - Export `executePlaygroundRequest(path: string, body: Record<string, unknown>, apiKey: string): Promise<PlaygroundResult>`
       - Uses `fetch('/api' + path, { method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + apiKey }, body: JSON.stringify(body) })`
       - Measures elapsed time with `performance.now()`
       - Reads `X-Credits-Cost` and `X-Credits-Remaining` from response headers (may be null if CORS doesn't expose them -- handle gracefully)
       - Parses response body as JSON (wrap in try/catch, return raw text as string on parse failure)
       - Does NOT throw on non-2xx -- returns the status code and error body so the response panel can display it

    2. Add types to `dashboard/src/types/api.ts`:
       - `OrderbookRequest`: `{ market_ticker: string; timestamp?: string; depth?: number }`
       - `OrderbookLevel`: `{ price: number; quantity: number }`
       - `OrderbookResponse`: `{ market_ticker: string; timestamp: string; yes: OrderbookLevel[]; no: OrderbookLevel[]; snapshot_basis: string; deltas_applied: number; response_time: number; request_id: string }`

    3. Create `dashboard/src/components/playground/use-playground.ts` -- custom hook managing all playground state:
       - **State fields**: marketTicker, timestamp, depth (form values); selectedKeyId, selectedKeyPrefix, revealedKey (key selection); curlCommand (generated code); isLoading, response (PlaygroundResult | null), activeTab ('code' | 'response') (request lifecycle)
       - **On mount (useEffect)**: Fetch keys via `api.keys.list()`, auto-select first key, auto-reveal it via `api.keys.reveal(keyId)`. Store revealed key in state. Handle empty keys gracefully (set error state).
       - **generateCurl (pure function, not exported)**: Builds multi-line curl command with backslash continuations. Uses POST to /orderbook. Body includes market_ticker always, timestamp and depth only if set. API key masked: show first 10 chars of prefix + `****...****`. Format:
         ```
         curl -X POST https://api.kalshibook.com/orderbook \
           -H "Content-Type: application/json" \
           -H "Authorization: Bearer kb_live_****...****" \
           -d '{
             "market_ticker": "TICKER"
           }'
         ```
       - **Curl auto-update**: useEffect depending on [marketTicker, timestamp, depth, selectedKeyPrefix] recalculates curlCommand
       - **sendRequest**: async function. Sets isLoading=true, calls executePlaygroundRequest('/orderbook', body, revealedKey), sets response and activeTab='response', sets isLoading=false. Handle case where revealedKey is null (show error).
       - **fillExample**: Sets marketTicker='KXBTC-25FEB14-T96074.99', timestamp='2025-02-14T18:00:00Z', depth='10'
       - **setField(field, value)**: Generic setter for form fields
       - **selectKey(keyId, keyPrefix)**: Updates selected key, triggers reveal
       - Export: `usePlayground()` returning all state + actions

    4. Create `dashboard/src/app/(dashboard)/playground/page.tsx`:
       - "use client" directive
       - Import `usePlayground` hook
       - Page header: h1 "API Playground", subtitle "Test API endpoints and see generated code"
       - Split-panel layout using flexbox:
         ```
         <div className="flex flex-col lg:flex-row gap-6">
           <div className="w-full lg:w-[400px] lg:shrink-0 space-y-6">
             {/* Left panel placeholder: <PlaygroundForm /> -- built in Plan 02 */}
             <Card><CardContent className="py-10 text-center text-sm text-muted-foreground">Form panel (Plan 02)</CardContent></Card>
           </div>
           <div className="flex-1 min-w-0">
             {/* Right panel placeholder: <CodeResponsePanel /> -- built in Plan 02/03 */}
             <Card><CardContent className="py-10 text-center text-sm text-muted-foreground">Code/Response panel (Plan 02-03)</CardContent></Card>
           </div>
         </div>
         ```
       - Wire usePlayground hook but placeholders for child components
       - Import Card, CardContent from shadcn/ui
  </action>
  <verify>
    - `dashboard/src/lib/playground.ts` exists and exports executePlaygroundRequest
    - `dashboard/src/components/playground/use-playground.ts` exists and exports usePlayground
    - `dashboard/src/app/(dashboard)/playground/page.tsx` exists with "use client" and split-panel layout
    - `cd dashboard && npx tsc --noEmit` passes (or `npx next build`)
    - Navigate to /playground in browser shows page with two placeholder cards side-by-side on desktop
  </verify>
  <done>Playground page renders at /playground with split-panel layout, usePlayground hook manages form state + curl generation + request lifecycle, playground fetch utility uses API key auth, sidebar nav shows Playground link</done>
</task>

</tasks>

<verification>
- `cd dashboard && npm ls prism-react-renderer` confirms dependency installed
- `dashboard/src/components/ui/tabs.tsx` exists (shadcn Tabs component)
- Sidebar nav in app-sidebar.tsx contains Playground entry between Overview and API Keys
- /playground route renders with split-panel layout (placeholder cards)
- TypeScript compilation passes with no errors
- usePlayground hook auto-fetches keys and generates curl command from form state
</verification>

<success_criteria>
Foundation complete: playground page accessible via sidebar, split-panel layout renders, state hook manages form/curl/request lifecycle, API key fetch utility ready for use.
</success_criteria>

<output>
After completion, create `.planning/phases/06-api-playground/06-01-SUMMARY.md`
</output>
