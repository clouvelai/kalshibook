---
phase: 06-api-playground
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - dashboard/src/components/playground/playground-form.tsx
  - dashboard/src/components/playground/code-panel.tsx
  - dashboard/src/components/playground/code-block.tsx
  - dashboard/src/app/(dashboard)/playground/page.tsx
autonomous: true

must_haves:
  truths:
    - "User can select an API key from a dropdown populated with their keys"
    - "User can enter a market ticker in a prominent required field"
    - "User can expand additional fields to set timestamp and depth"
    - "Curl command updates in real-time as form values change"
    - "Shell tab shows syntax-highlighted curl with copy button"
    - "Python and JavaScript tabs are visible but disabled with Coming soon tooltip"
    - "User can click Try an example to pre-fill form fields"
    - "Send Request button is full-width and prominent"
  artifacts:
    - path: "dashboard/src/components/playground/playground-form.tsx"
      provides: "Left panel with key selector, market ticker, additional fields, try example, send button"
      min_lines: 80
    - path: "dashboard/src/components/playground/code-panel.tsx"
      provides: "Right panel with language tabs (Shell active, Python/JS disabled) and code display"
      min_lines: 40
    - path: "dashboard/src/components/playground/code-block.tsx"
      provides: "Reusable syntax-highlighted code block with copy button"
      min_lines: 30
  key_links:
    - from: "dashboard/src/components/playground/playground-form.tsx"
      to: "dashboard/src/components/playground/use-playground.ts"
      via: "usePlayground hook props"
      pattern: "marketTicker|sendRequest|fillExample"
    - from: "dashboard/src/components/playground/code-panel.tsx"
      to: "dashboard/src/components/playground/code-block.tsx"
      via: "CodeBlock component rendering curl"
      pattern: "CodeBlock.*curlCommand"
    - from: "dashboard/src/components/playground/code-block.tsx"
      to: "prism-react-renderer"
      via: "Highlight component import"
      pattern: "import.*Highlight.*prism-react-renderer"
---

<objective>
Build the left-panel form (key selector, inputs, send button) and right-panel code display (language tabs, syntax-highlighted curl, copy button).

Purpose: Delivers the interactive input experience and live code generation -- the core playground interaction loop where form changes produce real-time curl updates.
Output: Fully functional form panel and code panel; user can configure requests and see generated curl commands.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-api-playground/06-RESEARCH.md
@.planning/phases/06-api-playground/06-01-SUMMARY.md
@dashboard/src/components/playground/use-playground.ts
@dashboard/src/lib/playground.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build PlaygroundForm component (left panel)</name>
  <files>
    dashboard/src/components/playground/playground-form.tsx
  </files>
  <action>
    Create `dashboard/src/components/playground/playground-form.tsx` -- the left panel containing all form inputs and actions.

    **Props interface** (passed from page, sourced from usePlayground):
    - keys: Array of { id, key_prefix, name, key_type } for the dropdown
    - selectedKeyId: string
    - marketTicker: string
    - timestamp: string
    - depth: string
    - isLoading: boolean
    - revealedKey: string | null (to know if send is enabled)
    - onSelectKey: (keyId: string, keyPrefix: string) => void
    - onSetField: (field: string, value: string) => void
    - onSendRequest: () => void
    - onFillExample: () => void

    **Layout** (top to bottom):

    1. **API Key selector** -- shadcn Select component:
       - Label "API Key"
       - Dropdown shows each key as: `key_prefix••••••••  (name)` -- prefix visible, rest masked
       - Auto-selects first key (controlled via selectedKeyId)
       - On change: call onSelectKey(keyId, keyPrefix)

    2. **Market Ticker** -- prominent required field:
       - Label "Market Ticker" with required asterisk
       - shadcn Input, placeholder "e.g. KXBTC-25FEB14-T96074.99"
       - Full width, slightly larger text to emphasize importance
       - Controlled value from marketTicker prop

    3. **Additional Fields** -- collapsible section:
       - Use a simple button toggle (ChevronDown/ChevronUp icon + "Additional fields" text)
       - useState for open/closed state, default closed
       - When open, show:
         - **Timestamp** -- Input with type="text", label "Timestamp (ISO 8601)", placeholder "e.g. 2025-02-14T18:00:00Z"
         - **Depth** -- Input with type="number", label "Depth", placeholder "e.g. 10", min=1
       - Animate with simple height transition (or just show/hide -- keep it clean)

    4. **"Try an example"** -- text link/button:
       - Styled as a subtle text button (text-sm, text-primary, underline or hover:underline)
       - Text: "Try an example"
       - onClick: onFillExample (pre-fills market ticker, timestamp, depth)
       - Positioned between additional fields and send button

    5. **Send Request** button -- full-width, prominent:
       - shadcn Button, default variant (primary), full width (`w-full`)
       - Text: "Send Request" with Play icon from lucide-react
       - When isLoading: show spinner (Loader2 icon with animate-spin) + "Sending..." text
       - Disabled when: isLoading, or !revealedKey (no key available), or !marketTicker (empty required field)
       - On click: onSendRequest

    Use shadcn Label, Input, Select, Button components. Import ChevronDown, ChevronUp, Play, Loader2 from lucide-react.
  </action>
  <verify>
    - File exists at `dashboard/src/components/playground/playground-form.tsx`
    - Contains Select for API key, Input for market ticker, collapsible additional fields, Try example link, Send Request button
    - `cd dashboard && npx tsc --noEmit` passes
  </verify>
  <done>PlaygroundForm renders key selector, market ticker input, collapsible additional fields (timestamp, depth), try example link, and full-width Send Request button with loading state</done>
</task>

<task type="auto">
  <name>Task 2: Build CodeBlock and CodePanel components, wire into page</name>
  <files>
    dashboard/src/components/playground/code-block.tsx
    dashboard/src/components/playground/code-panel.tsx
    dashboard/src/app/(dashboard)/playground/page.tsx
  </files>
  <action>
    1. Create `dashboard/src/components/playground/code-block.tsx` -- reusable syntax-highlighted code block:
       - Props: `{ code: string; language: string }` (language is "bash" or "json")
       - Uses `prism-react-renderer` v2 API: `import { Highlight, themes } from 'prism-react-renderer'`
       - Dark theme: `themes.vsDark`
       - Renders pre/code with dark background (`bg-[#1e1e1e]`), rounded corners, overflow-x-auto, text-sm, p-4
       - **Copy button** in absolute top-right corner:
         - Uses navigator.clipboard.writeText(code)
         - Shows Copy icon normally, Check icon for 2s after copy
         - Subtle styling: text-gray-400 hover:text-white, z-10
         - Import Copy, Check from lucide-react
         - Show sonner toast "Copied to clipboard" on copy
       - **Note on bash language**: prism-react-renderer v2 may or may not include bash by default. First try rendering with language="bash". If no highlighting appears, extend Prism:
         ```ts
         import { Prism } from 'prism-react-renderer';
         (typeof globalThis !== "undefined" ? globalThis : window).Prism = Prism;
         await import("prismjs/components/prism-bash");
         ```
         However, prefer the simpler approach first. If bash isn't bundled, use language="shell" or "sh" as alternatives. Fall back to plain text if none work.

    2. Create `dashboard/src/components/playground/code-panel.tsx` -- right panel code/language tabs:
       - Props: `{ curlCommand: string; response: PlaygroundResult | null; activeTab: 'code' | 'response'; onTabChange: (tab: 'code' | 'response') => void }`
       - **Top section**: Response | Code toggle tabs in the top-right corner using shadcn Tabs component:
         - TabsList with two TabsTrigger items: "Response" and "Code"
         - Controlled via activeTab prop, onChange calls onTabChange
       - **Language tabs** (shown when activeTab === 'code'):
         - Three small tabs/buttons below the main tabs: Shell (active), Python (disabled), JavaScript (disabled)
         - Shell tab: highlighted/active styling
         - Python and JavaScript tabs: grayed out, opacity-50, cursor-not-allowed
         - Disabled tabs wrapped in shadcn Tooltip with content "Coming soon"
         - No click behavior on disabled tabs
       - **Code display** (shown when activeTab === 'code'):
         - Render CodeBlock with code={curlCommand} language="bash"
       - **Response display** (shown when activeTab === 'response'):
         - If no response yet: render placeholder -- this will be replaced with full ResponsePanel in Plan 03
         - If response exists: render CodeBlock with code={JSON.stringify(response.data, null, 2)} language="json" as a temporary display (Plan 03 adds proper response panel with metadata + preview)
       - Overall container: Card with no padding (code block fills edge-to-edge inside the card rounded corners)

    3. Update `dashboard/src/app/(dashboard)/playground/page.tsx`:
       - Remove placeholder Card components
       - Import and render PlaygroundForm in left panel, passing all relevant usePlayground state/actions as props
       - Import and render CodePanel in right panel, passing curlCommand, response, activeTab, onTabChange
       - Wire all props correctly from usePlayground hook return values
       - Keep the page header (h1 + subtitle)
  </action>
  <verify>
    - `dashboard/src/components/playground/code-block.tsx` exists and uses prism-react-renderer Highlight
    - `dashboard/src/components/playground/code-panel.tsx` exists with Shell/Python/JS language tabs
    - `dashboard/src/app/(dashboard)/playground/page.tsx` renders PlaygroundForm and CodePanel (no more placeholders)
    - `cd dashboard && npx tsc --noEmit` passes
    - Navigate to /playground: left panel shows form with key selector and inputs, right panel shows syntax-highlighted curl that updates as form values change
    - Python and JavaScript tabs are grayed out with "Coming soon" tooltip on hover
  </verify>
  <done>CodeBlock renders syntax-highlighted code with copy button; CodePanel shows language tabs (Shell active, Python/JS disabled with tooltip); page wires form and code panel together with live curl updates</done>
</task>

</tasks>

<verification>
- PlaygroundForm renders complete left panel: key selector, market ticker, additional fields, try example, send button
- CodeBlock renders dark-themed syntax-highlighted code with copy-to-clipboard button
- CodePanel shows Response|Code toggle tabs, Shell/Python/JS language sub-tabs (Python/JS disabled)
- Curl command updates in real-time when form fields change
- "Try an example" pre-fills form with representative market data
- Send Request button disabled when no key or no ticker, shows loading spinner during request
- TypeScript compilation passes
</verification>

<success_criteria>
Form-to-code interaction loop complete: user selects key, enters market ticker, optionally sets timestamp/depth, sees live-updating syntax-highlighted curl command, can copy curl, can click Send Request.
</success_criteria>

<output>
After completion, create `.planning/phases/06-api-playground/06-02-SUMMARY.md`
</output>
