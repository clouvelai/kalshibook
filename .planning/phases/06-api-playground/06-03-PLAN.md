---
phase: 06-api-playground
plan: 03
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - dashboard/src/components/playground/response-panel.tsx
  - dashboard/src/components/playground/orderbook-preview.tsx
  - dashboard/src/components/playground/code-panel.tsx
  - dashboard/src/app/(dashboard)/playground/page.tsx
autonomous: true

must_haves:
  truths:
    - "After sending a request, response panel shows JSON sub-tab with syntax-highlighted response and copy button"
    - "Response panel shows Preview sub-tab with side-by-side orderbook table (yes/no columns with price/quantity)"
    - "Response metadata displays status code badge, response time, and credits deducted"
    - "Before first request, response area shows empty state with terminal icon and prompt text"
    - "During request execution, response area shows loading spinner"
    - "Error responses display with red status badge and structured error JSON"
    - "On mobile, form stacks above code/response panel (vertical layout)"
  artifacts:
    - path: "dashboard/src/components/playground/response-panel.tsx"
      provides: "Response display with JSON/Preview tabs, metadata bar, empty/loading/error states"
      min_lines: 60
    - path: "dashboard/src/components/playground/orderbook-preview.tsx"
      provides: "Side-by-side orderbook table for Preview sub-tab"
      min_lines: 30
  key_links:
    - from: "dashboard/src/components/playground/response-panel.tsx"
      to: "dashboard/src/components/playground/code-block.tsx"
      via: "CodeBlock for JSON syntax highlighting"
      pattern: "CodeBlock.*json"
    - from: "dashboard/src/components/playground/response-panel.tsx"
      to: "dashboard/src/components/playground/orderbook-preview.tsx"
      via: "OrderbookPreview for Preview tab"
      pattern: "OrderbookPreview"
    - from: "dashboard/src/components/playground/code-panel.tsx"
      to: "dashboard/src/components/playground/response-panel.tsx"
      via: "ResponsePanel rendered when activeTab is response"
      pattern: "ResponsePanel"
---

<objective>
Build the response panel with JSON/Preview tabs, metadata display, orderbook preview table, and all UX states (empty, loading, error). Complete the playground experience.

Purpose: Delivers the response visualization -- the final piece of the playground interaction loop. Users can now see structured API responses, preview orderbook data visually, and understand credit costs.
Output: Complete, polished API Playground page ready for use.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-api-playground/06-RESEARCH.md
@.planning/phases/06-api-playground/06-02-SUMMARY.md
@dashboard/src/components/playground/code-panel.tsx
@dashboard/src/components/playground/code-block.tsx
@dashboard/src/components/playground/use-playground.ts
@dashboard/src/lib/playground.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build ResponsePanel and OrderbookPreview components</name>
  <files>
    dashboard/src/components/playground/response-panel.tsx
    dashboard/src/components/playground/orderbook-preview.tsx
  </files>
  <action>
    1. Create `dashboard/src/components/playground/orderbook-preview.tsx`:
       - Props: `{ data: unknown }` (the response data from the API)
       - Attempts to parse data as orderbook format: checks for `yes` and `no` arrays
       - If valid orderbook data, renders side-by-side table layout:
         - Grid with 2 columns (grid-cols-2 gap-4 p-4)
         - Left column: "Yes" header (text-green-600), table with Price and Qty columns
         - Right column: "No" header (text-red-600), table with Price and Qty columns
         - Each row: price displayed as cents (e.g. "45Â¢"), quantity as integer
         - Summary header above tables showing: market_ticker, timestamp, snapshot_basis, deltas_applied count
       - If data doesn't match orderbook format, render a fallback message: "Preview not available for this response format"
       - Clean, compact table styling matching dashboard aesthetic (text-sm, borders, muted header row)

    2. Create `dashboard/src/components/playground/response-panel.tsx`:
       - Props: `{ response: PlaygroundResult | null; isLoading: boolean }`
       - Import PlaygroundResult type from `@/lib/playground`

       **States:**

       a. **Empty state** (response is null AND !isLoading):
          - Centered layout in the panel area
          - Terminal icon (lucide-react) in muted color, size-10
          - Text: "Send a request to see the response" (text-muted-foreground)
          - Subtle sub-text: "Configure your request on the left and click Send Request"
          - Vertically and horizontally centered (flex items-center justify-center, min-h-[300px])

       b. **Loading state** (isLoading):
          - Centered Loader2 icon with animate-spin
          - Text: "Executing request..." (text-muted-foreground)
          - Same centering as empty state

       c. **Response state** (response exists):
          - **Metadata bar** -- slim horizontal bar at the top:
            - Status code Badge: variant="secondary" for 2xx, variant="destructive" for 4xx/5xx
            - Response time: `{responseTime.toFixed(0)}ms` in muted text
            - Credits deducted: `{creditsDeducted} credits` in muted text (only shown if creditsDeducted is not null)
            - Flex row with gap-4, px-4 py-2, border-b, bg-muted/50, text-sm
          - **JSON | Preview sub-tabs** -- shadcn Tabs below metadata bar:
            - TabsList with "JSON" and "Preview" triggers
            - Default to "JSON" tab
            - **JSON tab**: Render CodeBlock with `code={JSON.stringify(response.data, null, 2)}` language="json"
            - **Preview tab**: Render OrderbookPreview with `data={response.data}`
          - Import Badge from shadcn/ui
          - Import Tabs, TabsContent, TabsList, TabsTrigger from shadcn/ui
          - Import CodeBlock from ./code-block
          - Import OrderbookPreview from ./orderbook-preview
  </action>
  <verify>
    - `dashboard/src/components/playground/response-panel.tsx` exists with empty, loading, and response states
    - `dashboard/src/components/playground/orderbook-preview.tsx` exists with side-by-side yes/no tables
    - `cd dashboard && npx tsc --noEmit` passes
  </verify>
  <done>ResponsePanel renders three states (empty, loading, response) with metadata bar, JSON/Preview sub-tabs; OrderbookPreview shows side-by-side orderbook table with price/quantity levels</done>
</task>

<task type="auto">
  <name>Task 2: Wire ResponsePanel into CodePanel and finalize page</name>
  <files>
    dashboard/src/components/playground/code-panel.tsx
    dashboard/src/app/(dashboard)/playground/page.tsx
  </files>
  <action>
    1. Update `dashboard/src/components/playground/code-panel.tsx`:
       - Add `isLoading: boolean` to props
       - Import ResponsePanel from ./response-panel
       - Replace the temporary response display (the inline CodeBlock for JSON) with `<ResponsePanel response={response} isLoading={isLoading} />`
       - When activeTab === 'response': render ResponsePanel
       - When activeTab === 'code': render existing language tabs + CodeBlock with curl
       - If no response and activeTab === 'response': ResponsePanel handles the empty state internally
       - Ensure the Code/Response top-level tabs remain controlled via activeTab/onTabChange props

    2. Update `dashboard/src/app/(dashboard)/playground/page.tsx`:
       - Pass `isLoading` prop through to CodePanel (should already be available from usePlayground)
       - Verify all props are correctly threaded: form props to PlaygroundForm, code/response props to CodePanel
       - Ensure mobile layout works: flex-col on small screens (form stacks on top, code/response below)
       - Add a subtle note below the page subtitle about credit costs: "Requests from the playground use your API credits" (text-xs text-muted-foreground)
       - Verify the page renders correctly end-to-end:
         - Before any request: Code tab shows curl, Response tab shows empty state
         - Click Send: loading spinner, then response with metadata + JSON/Preview tabs
         - Try an example fills fields and updates curl
         - Copy button on curl and JSON works
  </action>
  <verify>
    - CodePanel renders ResponsePanel when activeTab is 'response'
    - ResponsePanel shows empty state before any request is sent
    - `cd dashboard && npx tsc --noEmit` passes
    - Full interaction flow works: fill form -> curl updates -> send request -> response displays with metadata + JSON/Preview
    - Mobile layout: form stacks on top, code/response below (verify with responsive dev tools or narrow browser window)
    - Copy button works on both curl and JSON response
  </verify>
  <done>Complete API Playground: form configures requests, curl updates live, send executes against backend with API key auth, response shows metadata bar + JSON/Preview tabs, orderbook preview renders bid/ask table, empty/loading/error states handled, mobile responsive</done>
</task>

</tasks>

<verification>
- ResponsePanel shows empty state (terminal icon + prompt text) before first request
- ResponsePanel shows loading spinner during request execution
- ResponsePanel shows metadata bar (status badge, response time, credits) after request completes
- JSON sub-tab renders syntax-highlighted copyable JSON
- Preview sub-tab renders side-by-side orderbook table (yes/no sides with price/quantity)
- Error responses show red status badge with error JSON
- Mobile layout stacks form above code/response panel
- Full end-to-end flow: configure -> see curl -> send -> see response
- TypeScript compilation passes
</verification>

<success_criteria>
API Playground is complete and usable: users can select an API key, configure orderbook requests, see live curl generation, execute requests, view JSON responses with syntax highlighting, preview orderbook data in a table, and understand credit costs -- all within a polished split-panel interface matching the Tavily playground aesthetic.
</success_criteria>

<output>
After completion, create `.planning/phases/06-api-playground/06-03-SUMMARY.md`
</output>
