---
phase: 14-playground-upgrade
plan: 02
type: execute
wave: 2
depends_on: ["14-01"]
files_modified:
  - dashboard/src/types/api.ts
  - dashboard/src/lib/api.ts
  - dashboard/src/lib/playground.ts
  - dashboard/src/components/playground/ticker-combobox.tsx
  - dashboard/src/components/playground/example-cards.tsx
  - dashboard/src/components/playground/use-playground.ts
  - dashboard/src/components/playground/playground-form.tsx
  - dashboard/src/app/(dashboard)/playground/page.tsx
autonomous: true

must_haves:
  truths:
    - "Playground ticker input shows autocomplete suggestions from markets with confirmed data when user types 2+ characters"
    - "Selecting an autocomplete suggestion fills the ticker field and updates the form"
    - "Playground shows 3 example cards (orderbook, trades, candles) that execute with one click via the demo endpoint"
    - "Example cards pull ticker from a real covered market (not hardcoded), guaranteeing data availability"
    - "Clicking an example card shows results without deducting credits"
    - "The old hardcoded fillExample (KXBTC-25FEB14-T96074.99) is removed and replaced with dynamic examples"
  artifacts:
    - path: "dashboard/src/components/playground/ticker-combobox.tsx"
      provides: "Autocomplete combobox for market ticker selection"
      min_lines: 40
    - path: "dashboard/src/components/playground/example-cards.tsx"
      provides: "Clickable example query cards for orderbook, trades, candles"
      min_lines: 30
    - path: "dashboard/src/types/api.ts"
      provides: "PlaygroundMarket and DemoResponse TypeScript types"
      contains: "PlaygroundMarket"
    - path: "dashboard/src/lib/api.ts"
      provides: "playground.markets() and playground.demo() API methods"
      contains: "playground"
  key_links:
    - from: "dashboard/src/components/playground/ticker-combobox.tsx"
      to: "/playground/markets"
      via: "api.playground.markets() call with debounced query"
      pattern: "api\\.playground\\.markets"
    - from: "dashboard/src/components/playground/example-cards.tsx"
      to: "/playground/demo"
      via: "api.playground.demo() call on card click"
      pattern: "api\\.playground\\.demo"
    - from: "dashboard/src/components/playground/playground-form.tsx"
      to: "dashboard/src/components/playground/ticker-combobox.tsx"
      via: "TickerCombobox component replacing Input"
      pattern: "TickerCombobox"
    - from: "dashboard/src/app/(dashboard)/playground/page.tsx"
      to: "dashboard/src/components/playground/example-cards.tsx"
      via: "ExampleCards component in page layout"
      pattern: "ExampleCards"
---

<objective>
Wire the frontend: add TypeScript types, API client methods, TickerCombobox autocomplete, ExampleCards component, and integrate everything into the playground page.

Purpose: This completes all four PLAY requirements -- real tickers (PLAY-01), autocomplete (PLAY-02), example cards (PLAY-03), and zero-credit demos (PLAY-04) -- by connecting the backend endpoints from Plan 01 to the existing playground UI.

Output: Full working playground with autocomplete ticker search, clickable example cards, and zero-credit demo execution.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-playground-upgrade/14-RESEARCH.md
@.planning/phases/14-playground-upgrade/14-01-SUMMARY.md
@dashboard/src/types/api.ts
@dashboard/src/lib/api.ts
@dashboard/src/lib/playground.ts
@dashboard/src/components/playground/use-playground.ts
@dashboard/src/components/playground/playground-form.tsx
@dashboard/src/app/(dashboard)/playground/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add TypeScript types and API client methods for playground endpoints</name>
  <files>
    dashboard/src/types/api.ts
    dashboard/src/lib/api.ts
  </files>
  <action>
**1. Add types to `dashboard/src/types/api.ts`:**

Add after the Coverage types section:

```typescript
/** Playground types */

export interface PlaygroundMarket {
  ticker: string;
  title: string | null;
  status: string | null;
  event_ticker: string | null;
  first_date: string | null;
  last_date: string | null;
}

export interface DemoRequest {
  endpoint: "orderbook" | "trades" | "candles";
  market_ticker: string;
  timestamp?: string;
  depth?: number;
  start_time?: string;
  end_time?: string;
  interval?: string;
  limit?: number;
}

export interface DemoResponse {
  endpoint: string;
  data: unknown;
  response_time: number;
  request_id: string;
  credits_cost: number;
}
```

**2. Add playground namespace to `dashboard/src/lib/api.ts`:**

Import the new types: add `DemoRequest`, `DemoResponse`, `PlaygroundMarket` to the imports from `@/types/api`.

Add a `playground` namespace to the `api` object (after the `coverage` namespace):

```typescript
playground: {
  markets: (q: string, limit = 10) =>
    fetchAPI<{ data: PlaygroundMarket[]; request_id: string }>(
      `/playground/markets?q=${encodeURIComponent(q)}&limit=${limit}`
    ),
  demo: (body: DemoRequest) =>
    fetchAPI<DemoResponse>("/playground/demo", {
      method: "POST",
      body: JSON.stringify(body),
    }),
},
```
  </action>
  <verify>
Run: `cd /Users/samuelclark/Desktop/kalshibook/dashboard && npx tsc --noEmit --pretty 2>&1 | head -30` to verify no TypeScript errors.
  </verify>
  <done>
- `PlaygroundMarket`, `DemoRequest`, `DemoResponse` types exist in `types/api.ts`
- `api.playground.markets()` and `api.playground.demo()` methods exist in `lib/api.ts`
- Both use `fetchAPI` (JWT-authenticated, same as coverage)
- No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Build TickerCombobox, ExampleCards, and integrate into playground</name>
  <files>
    dashboard/src/components/playground/ticker-combobox.tsx
    dashboard/src/components/playground/example-cards.tsx
    dashboard/src/components/playground/use-playground.ts
    dashboard/src/components/playground/playground-form.tsx
    dashboard/src/app/(dashboard)/playground/page.tsx
  </files>
  <action>
**1. Create `dashboard/src/components/playground/ticker-combobox.tsx`:**

Build a combobox component using shadcn Popover + Command (cmdk):

- Props: `value: string` (current ticker), `onSelect: (market: PlaygroundMarket) => void`, `onChange: (value: string) => void` (for manual typing)
- State: `open` (popover), `query` (search input), `results` (PlaygroundMarket[]), `loading`
- Debounced search: useEffect with 200ms setTimeout. When `query.length >= 2`, call `api.playground.markets(query)`. Set `shouldFilter={false}` on Command (server-side filtering).
- Display: Each CommandItem shows ticker (font-mono, text-sm) and title (text-muted-foreground, truncated). Show status badge if settled.
- On select: Call `onSelect(market)`, close popover. The parent form sets marketTicker to the selected ticker.
- Allow free typing: The input value should be usable even without selecting from dropdown (for power users who know their ticker). Bind `onChange` to the CommandInput's onValueChange to sync back to parent.
- Empty state: "No markets found" when query returns no results. "Type to search markets..." when query < 2 chars.
- Trigger button: Show the current ticker value or "Search markets..." placeholder. Use `variant="outline"` with `role="combobox"`.

**2. Create `dashboard/src/components/playground/example-cards.tsx`:**

Build an ExampleCards component that:

- On mount, fetches a single featured market from `api.playground.markets("", 1)` (empty query, limit 1 -- returns the market with the most recent coverage data). Store the result as `featuredMarket`.
- Defines 3 example card configs:
  - **Orderbook Reconstruction**: endpoint "orderbook", icon BookOpen (from lucide-react), uses featuredMarket.ticker and a timestamp at the midpoint between first_date and last_date (compute as: parse first_date and last_date, midpoint = new Date((start + end) / 2).toISOString()), depth 10.
  - **Trade History**: endpoint "trades", icon BarChart3, uses featuredMarket.ticker, start_time = first_date + "T00:00:00Z", end_time = first_date + "T23:59:59Z" (one day of trades), limit 20.
  - **Price Candles**: endpoint "candles", icon CandlestickChart (or TrendingUp if CandlestickChart not available in lucide-react), uses featuredMarket.ticker, start_time = first_date + "T00:00:00Z", end_time = last_date + "T23:59:59Z", interval "1h".
- Props: `onExecute: (result: DemoResponse) => void`, `onError: (error: string) => void`
- Each card: On click, calls `api.playground.demo()` with the configured params. Shows a brief loading spinner on the clicked card. On success, calls `onExecute(result)`. On error, calls `onError(message)`.
- Layout: 3 cards in a responsive grid (grid-cols-1 sm:grid-cols-3 gap-3).
- Each card shows: icon, title, one-line description, endpoint badge. Use Card/CardContent from shadcn. `cursor-pointer hover:border-primary/50 transition-colors`.
- While `featuredMarket` is loading, show skeleton cards or a loading state.

**3. Modify `dashboard/src/components/playground/use-playground.ts`:**

- Remove the hardcoded `fillExample` callback that sets `KXBTC-25FEB14-T96074.99`. Remove the `fillExample` function entirely.
- Remove `fillExample` from `PlaygroundActions` interface.
- Add a new state: `demoResult: PlaygroundResult | null` and a new action `setDemoResult: (result: PlaygroundResult | null) => void`.
- Add action `handleDemoResult: (result: DemoResponse) => void` that:
  - Converts DemoResponse to PlaygroundResult format: `{ data: result.data, status: 200, responseTime: Math.round(result.response_time * 1000), creditsDeducted: 0, creditsRemaining: null }`
  - Sets it as the response and switches activeTab to "response".

**4. Modify `dashboard/src/components/playground/playground-form.tsx`:**

- Replace the `<Input>` for market ticker with `<TickerCombobox>`:
  - `value={marketTicker}`
  - `onSelect={(market) => onSetField("marketTicker", market.ticker)}`
  - `onChange={(value) => onSetField("marketTicker", value)}`
- Remove the `onFillExample` prop and the "Try an example" button link (this is replaced by ExampleCards on the page).
- Update the `PlaygroundFormProps` interface: remove `onFillExample`.

**5. Modify `dashboard/src/app/(dashboard)/playground/page.tsx`:**

- Import `ExampleCards` from `@/components/playground/example-cards`.
- Add the ExampleCards section between the page header and the split-panel layout:
  ```tsx
  {/* Example cards */}
  <ExampleCards
    onExecute={playground.handleDemoResult}
    onError={(msg) => {/* set requestError */}}
  />
  ```
- Update the header subtitle: change "Requests from the playground use your API credits" to "Try the examples below for free, or use your API key for custom queries".
- Remove the `onFillExample` prop from `<PlaygroundForm>`.
  </action>
  <verify>
Run: `cd /Users/samuelclark/Desktop/kalshibook/dashboard && npx tsc --noEmit --pretty 2>&1 | head -40` to verify no TypeScript errors.

Run: `ls dashboard/src/components/playground/ticker-combobox.tsx dashboard/src/components/playground/example-cards.tsx` to verify new files exist.

Verify the old hardcoded ticker is gone: `grep -r "KXBTC-25FEB14" dashboard/src/` should return nothing.
  </verify>
  <done>
- TickerCombobox renders a Popover+Command combobox with debounced server-side search
- ExampleCards shows 3 clickable cards (orderbook, trades, candles) that auto-execute via demo endpoint
- Example cards dynamically pull a featured market ticker from coverage data (not hardcoded)
- Clicking an example card shows results in the response panel with 0 credits deducted
- The old hardcoded "KXBTC-25FEB14-T96074.99" fillExample is removed
- PlaygroundForm uses TickerCombobox instead of plain Input for market ticker
- No TypeScript compilation errors
  </done>
</task>

</tasks>

<verification>
1. TypeScript compilation: `npx tsc --noEmit` succeeds with no errors
2. Hardcoded ticker removed: no references to `KXBTC-25FEB14` in dashboard source
3. New components exist: `ticker-combobox.tsx`, `example-cards.tsx`
4. API client extended: `api.playground.markets()` and `api.playground.demo()` exist
5. Playground page renders ExampleCards and uses TickerCombobox
</verification>

<success_criteria>
- Typing in the ticker field triggers autocomplete suggestions from covered markets (PLAY-01 + PLAY-02)
- Three example cards appear on the playground page and execute with one click (PLAY-03)
- All demo interactions show 0 credits deducted (PLAY-04)
- No hardcoded stale tickers remain in the codebase
</success_criteria>

<output>
After completion, create `.planning/phases/14-playground-upgrade/14-02-SUMMARY.md`
</output>
